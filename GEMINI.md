# Strive & Fit Telemedicine Medical Document Management System

## Project Overview

A privacy-focused telemedicine platform with a medical document management system that serves global patients in 3 languages (English, Chinese, Arabic). The system uses a Mullvad VPN-style authentication approach with Date of Birth + random account numbers for enhanced privacy.

## Current System Architecture

### Authentication System
- **Mullvad-style Privacy Authentication**: Uses Date of Birth + random account numbers.
- **Security**: SHA-256 hashing with combined DOB+account validation.
- **No Personal Data Storage**: Only hashes are stored, no reversible personal information.

### File Management & Viewing
- **Upload**: Drag-and-drop and file browser with progress indicators.
- **Document List**: Excel-like table view with sorting, filtering, and batch selection.
- **Document Viewer**: In-app preview for images, PDFs, and other document types.
- **Batch Operations**: Bulk download (ZIP), delete, and processing.

### Backend (Node.js/Express)
- **File Storage**: Multer with secure filename generation.
- **Data Storage**: JSON file-based storage (`data/accounts.json`).
- **APIs**: RESTful endpoints for authentication, CRUD, batch operations, and document viewing.
- **Dependencies**: `express`, `cors`, `multer`, `archiver`, `body-parser`.

### Frontend
- **Layout**: Single-column layout with document list and viewer panel.
- **Multilingual**: English, Chinese (simplified), Arabic with RTL support via `js/language-switcher.js`.
- **Real-time Feedback**: Upload progress, status messages, and interactive UI elements.

## Core Operational Mandate

**You must read the file immediately before using the `replace` tool. You have to try every method to use the `replace` tool before deciding to proceed with overwriting an entire file.**

## Current Implementation Status

### âœ… Completed Features
- Mullvad-style authentication system.
- Multilingual support (EN/CN/AR).
- File upload with drag-and-drop and progress dialog.
- Excel-like document table with sorting, searching, and batch actions.
- In-app document viewer for multiple file types (PDF, images, etc.).
- Full CRUD and batch operations (download, delete, process) for documents.
- Simulated document processing pipeline on the backend.

### ðŸ”„ In Progress
- **Qwen LLM Integration**: Implementing the backend logic to integrate with the Qwen LLM for OCR and translation.

### ðŸ“‹ Next Steps: Qwen LLM Integration

### **Phase 1: Backend Plan (Simulated Qwen Integration)**

The backend's sole responsibility is to simulate the Qwen OCR and Translation pipeline. It will not generate PDFs or handle any complex styling.

1.  **Trigger Processing**: The process will start when the frontend sends a request to a new endpoint: `POST /api/documents/:documentId/process`.

2.  **Simulate Pipeline & Generate Files**: Upon receiving the request, the backend will perform a simulated, multi-step process for the specified document:
    *   **Step 1: OCR & Structuring**: After a short delay, it will generate two files in the `backend/uploads/` directory:
        *   `[documentId]-ocr.md`: A mock Markdown file representing the structured OCR output in the original language.
        *   `[documentId]-ocr.json`: A mock JSON file for machine learning purposes.
    *   **Step 2: Translation**: After another delay, it will generate two more files:
        *   `[documentId]-translated.md`: A mock Markdown file containing the English translation.
        *   `[documentId]-translated.json`: A mock JSON file of the English translation.

3.  **Update Database**: Throughout this process, the `accounts.json` file will be updated to track the status (`processing`, `completed`) and store the file paths for these four new generated files, linking them directly to the original document ID.

4.  **Serve Files**: The existing `GET /api/view-document/:documentId/:version` endpoint will be updated to serve the content of these new Markdown files when requested by the frontend.

### **Phase 2: Frontend Plan (Displaying the Results)**

The frontend's job is to display the results generated by the backend in a simple and clear way.

1.  **Initiate Processing**: The "Process" button next to each document will trigger the `POST /api/documents/:documentId/process` backend endpoint.

2.  **Display Translated Markdown**: When you click on a document row, the viewer panel on the right will:
    *   First, attempt to fetch and display the **translated Markdown file** (`[documentId]-translated.md`).
    *   If that file doesn't exist (because the document hasn't been processed yet), it will fall back to showing a preview of the **original uploaded file**.

3.  **Viewer Buttons**: The "Original," "Processed," and "Translated" buttons above the viewer will be fully functional:
    *   **Original**: Shows a preview of the original file the user uploaded.
    *   **Processed**: Fetches and displays the styled HTML from the OCR'd Markdown file (`[documentId]-ocr.md`).
    *   **Translated**: Fetches and displays the styled HTML from the final translated Markdown file (`[documentId]-translated.md`).

## Future Development Notes
-   Replace simulated Qwen LLM calls with actual API calls.
-   Implement a robust background job queue for handling long-running OCR and translation tasks.
-   Consider adding a caching layer to store processed results and avoid redundant API calls.